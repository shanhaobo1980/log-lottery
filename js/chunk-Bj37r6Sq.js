import{d as e,l as a,u as l,w as s,z as t,c as i,o as n,U as o,a as u,n as r,g as v,r as c,i as m,h as d,P as p,v as f,K as g,Q as b,X as h,b as k,x as y,V as w}from"./chunk-B1GhtS-6.js";import{u as x,b as I,f as _}from"./chunk-6arlBFx2.js";import{_ as N}from"./chunk-DA2z3M7Z.js";import{_ as U}from"./chunk-DQpb1X2O.js";import"./chunk-DsM932Ci.js";const j={class:"toast toast-top toast-end"},C={key:0,class:"alert alert-error"},S={key:1,class:"alert alert-success"},D={key:2,class:"alert alert-error"},q={class:"flex flex-col items-center gap-6 w-full px-12"},F=["disabled","placeholder"],M=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:y}=a(),w=c("image/*"),_=c(0),N=l(e,"visible"),M=x().globalConfig,T=s.createInstance({name:"imgStore"}),V=c(null),z=k({get:()=>V.value?.fileName||null,set(e){V.value&&e&&(V.value.fileName=e)}}),B=c();async function H(e){if(!e)return void(V.value=null);/image*/.test(e?.type||"")?V.value=e:_.value=3}function K(){if(V.value){const{data:e,fileName:a}=V.value,l=f();T.setItem(l,{data:e,fileName:a}).then(()=>{_.value=1,async function(){(await T.keys()).length>0&&T.iterate((e,a)=>{M.addImage({id:a,name:e.fileName,url:"Storage"})})}()}).catch(()=>{_.value=2})}}return t(N,e=>{e&&B.value.showDialog()}),(e,a)=>(n(),i(o,null,[u("div",j,[2===_.value?(n(),i("div",C,[u("span",null,m(d(y)("error.uploadFail")),1)])):v("",!0),1===_.value?(n(),i("div",S,[u("span",null,m(d(y)("error.uploadSuccess")),1)])):v("",!0),3===_.value?(n(),i("div",D,[u("span",null,m(d(y)("error.notImage")),1)])):v("",!0)]),r(I,{ref_key:"uploadDialogRef",ref:B,visible:N.value,"onUpdate:visible":a[1]||(a[1]=e=>N.value=e),title:d(y)("dialog.uploadImageTitle"),"submit-func":K,class:""},{content:p(()=>[u("div",q,[N.value?(n(),g(U,{key:0,"limit-type":w.value,onUploadFile:H},null,8,["limit-type"])):v("",!0),b(u("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),disabled:null===V.value,type:"text",placeholder:d(y)("placeHolder.imageName"),class:"input w-full"},null,8,F),[[h,z.value]])])]),_:1},8,["visible","title"])],64))}}),T={class:""},V={for:"explore"},z={class:"p-0"},B={class:"flex items-center gap-8"},H={class:"avatar h-14"},K={class:"w-12 h-12 mask mask-squircle hover:w-14 hover:h-14"},L={class:"w-64"},P={class:"overflow-hidden font-bold whitespace-nowrap text-ellipsis"},Q=["onClick"],R=e({__name:"index",setup(e){const{t:l}=a(),v=x().globalConfig,{getImageList:f}=y(v),g=c(0),b=s.createInstance({name:"imgStore"}),h=c(!1);return t(()=>g.value,e=>{0!==e&&setTimeout(()=>{g.value=0},2e3)}),(e,a)=>(n(),i(o,null,[r(M,{visible:h.value,"onUpdate:visible":a[0]||(a[0]=e=>h.value=e)},null,8,["visible"]),u("div",null,[r(N,{title:d(l)("sidebar.imagesManagement")},{buttons:p(()=>[u("div",T,[u("label",V,[u("span",{class:"btn btn-primary btn-sm",onClick:a[1]||(a[1]=e=>h.value=!0)},m(d(l)("button.upload")),1)])])]),_:1},8,["title"]),u("ul",z,[(n(!0),i(o,null,w(d(f),e=>(n(),i("li",{key:e.id,class:"mb-3"},[u("div",B,[u("div",H,[u("div",K,[r(_,{"img-item":e},null,8,["img-item"])])]),u("div",L,[u("div",P,m(e.name),1)]),u("div",null,[u("button",{class:"btn btn-error btn-xs",onClick:a=>function(e){"Storage"===e.url&&b.removeItem(e.id).then(()=>{v.removeImage(e.id)}),v.removeImage(e.id)}(e)},m(d(l)("button.delete")),9,Q)])])]))),128))])])],64))}});export{R as default};
