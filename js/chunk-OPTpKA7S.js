import{a4 as e,w as l,x as t,r as a,aq as s,f as n,z as o,d as u,l as i,c,o as r,n as d,P as p,h as b,_ as m,ar as f,a as x,i as g,U as h,V as v,T as w,g as C,as as k,Q as y,X as z,Z as U,Y as P}from"./chunk-B1GhtS-6.js";import{u as L,i as D,d as V}from"./chunk-6arlBFx2.js";import{_ as j}from"./chunk-DA2z3M7Z.js";function S(){const u=e.useToast(),i=l.createInstance({name:"imgStore"}),c=L().prizeConfig,r=L().globalConfig,{getPrizeConfig:d,getCurrentPrize:p}=t(c),{getImageList:b}=t(r),m=a([]),f=a(s(d.value)),x=a();return n(()=>{!async function(){(await i.keys()).length>0&&i.iterate((e,l)=>{m.value.push({key:l,value:e})})}()}),o(()=>f.value,e=>{c.setPrizeConfig(e)},{deep:!0}),{addPrize:function(){const e={id:(new Date).getTime().toString(),name:D.global.t("data.prizeName"),sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1};f.value.push(e),u.success(D.global.t("error.success"))},resetDefault:function(){c.resetDefault(),f.value=s(d.value),u.success(D.global.t("error.success"))},delAll:async function(){f.value=[],u.success(D.global.t("error.success"))},delItem:function(e){c.deletePrizeConfig(e.id),u.success(D.global.t("error.deleteSuccess"))},prizeList:f,currentPrize:p,selectedPrize:x,submitData:function(e){x.value.separateCount.countList=e,x.value=null},changePrizePerson:function(e){let l=-1;for(let t=0;t<f.value.length;t++)if(f.value[t].id===e.id){l=t;break}l>-1&&(f.value[l].separateCount.countList=[],f.value[l].isUsed?f.value[l].isUsedCount=f.value[l].count:f.value[l].isUsedCount=0)},changePrizeStatus:function(e){e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed},selectPrize:function(e){x.value=e,x.value.isUsedCount=0,x.value.isUsed=!1,x.value.separateCount.countList.length>1||(x.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})},localImageList:b}}const A={class:"flex w-full gap-3"},I={role:"alert",class:"w-full my-4 alert alert-info"},_={class:"flex items-center justify-center max-w-xs px-2 handle form-control"},$={class:"w-1/2 max-w-xs form-control"},T={class:"label"},M={class:"label-text"},N=["onUpdate:modelValue","placeholder"],q={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},H={class:"label"},B={class:"label-text"},Q=["checked","onChange"],R={class:"w-1/2 max-w-xs form-control"},X={class:"label"},Y={class:"label-text"},Z=["onUpdate:modelValue","placeholder","onChange"],E=["data-tip"],F=["value","max"],G={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},J={class:"label"},K={class:"label-text"},O=["checked","onChange"],W={class:"w-full max-w-xs form-control"},ee={class:"label"},le={class:"label-text"},te=["onUpdate:modelValue"],ae={key:0,value:{id:"",name:"",url:""}},se={disabled:"",selected:""},ne=["title","value"],oe={key:0,class:"w-full max-w-xs form-control"},ue={class:"label"},ie={class:"label-text"},ce=["onClick"],re={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},de=["data-tip"],pe={key:1,class:"btn btn-secondary btn-xs"},be={class:"w-full max-w-xs form-control"},me={class:"label"},fe={class:"label-text"},xe={class:"flex gap-2"},ge=["onClick"],he=u({__name:"PrizeConfig",setup(e){const{addPrize:l,resetDefault:t,delAll:a,delItem:s,prizeList:n,currentPrize:o,selectedPrize:u,submitData:L,changePrizePerson:D,changePrizeStatus:he,selectPrize:ve,localImageList:we}=S(),{t:Ce}=i();return(e,i)=>(r(),c("div",null,[d(j,{title:b(Ce)("viewTitle.prizeManagement")},{buttons:p(()=>[x("div",A,[x("button",{class:"btn btn-info btn-sm",onClick:i[0]||(i[0]=(...e)=>b(l)&&b(l)(...e))},g(b(Ce)("button.add")),1),x("button",{class:"btn btn-info btn-sm",onClick:i[1]||(i[1]=(...e)=>b(t)&&b(t)(...e))},g(b(Ce)("button.resetDefault")),1),x("button",{class:"btn btn-error btn-sm",onClick:i[2]||(i[2]=(...e)=>b(a)&&b(a)(...e))},g(b(Ce)("button.allDelete")),1)])]),alerts:p(()=>[x("div",I,[i[4]||(i[4]=x("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),x("span",null,g(b(Ce)("dialog.tipResetPrize")),1)])]),_:1},8,["title"]),d(b(f),{modelValue:b(n),"onUpdate:modelValue":i[3]||(i[3]=e=>m(n)?n.value=e:null),animation:150,handle:".handle",class:"p-0 m-0"},{default:p(()=>[(r(!0),c(h,null,v(b(n),e=>(r(),c("div",{key:e.id,class:w(["flex items-center justify-center gap-10 py-5",b(o).id===e.id?"border border-dotted rounded-xl":null])},[x("label",_,[d(b(k),{class:"w-10 h-10 cursor-move handle"})]),x("label",$,[x("div",T,[x("span",M,g(b(Ce)("table.prizeName")),1)]),y(x("input",{"onUpdate:modelValue":l=>e.name=l,type:"text",placeholder:b(Ce)("placeHolder.name"),class:"w-full max-w-xs input-sm input input-bordered"},null,8,N),[[z,e.name]])]),x("label",q,[x("div",H,[x("span",B,g(b(Ce)("table.fullParticipation")),1)]),x("input",{type:"checkbox",checked:e.isAll,class:"border-solid checkbox checkbox-secondary border",onChange:l=>e.isAll=!e.isAll},null,40,Q)]),x("label",R,[x("div",X,[x("span",Y,g(b(Ce)("table.numberParticipants")),1)]),y(x("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",placeholder:b(Ce)("placeHolder.winnerCount"),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered",onChange:l=>b(D)(e)},null,40,Z),[[z,e.count]]),x("div",{class:"tooltip tooltip-bottom","data-tip":`${b(Ce)("table.isDone")+e.isUsedCount}/${e.count}`},[x("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,F)],8,E)]),x("label",G,[x("div",J,[x("span",K,g(b(Ce)("table.isDone")),1)]),x("input",{type:"checkbox",checked:e.isUsed,class:"border-solid checkbox checkbox-secondary border",onChange:l=>b(he)(e)},null,40,O)]),x("label",W,[x("div",ee,[x("span",le,g(b(Ce)("table.image")),1)]),y(x("select",{"onUpdate:modelValue":l=>e.picture=l,class:"truncate select select-warning select-sm"},[e.picture.id?(r(),c("option",ae,"âŒ")):C("",!0),x("option",se,g(b(Ce)("table.selectPicture")),1),(r(!0),c(h,null,v(b(we),e=>(r(),c("option",{key:e.id,title:e.name,class:"w-full max-w-full",value:e},g(e.name),9,ne))),128))],8,te),[[U,e.picture]])]),e.separateCount?(r(),c("label",oe,[x("div",ue,[x("span",ie,g(b(Ce)("table.onceNumber")),1)]),x("div",{class:"flex justify-start w-full h-full",onClick:l=>b(ve)(e)},[e.separateCount.countList.length?(r(),c("ul",re,[(r(!0),c(h,null,v(e.separateCount.countList,e=>(r(),c("li",{key:e.id,class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated"},[x("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":`${b(Ce)("tooltip.doneCount")+e.isUsedCount}/${e.count}`},[x("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:P(`width:${100*e.isUsedCount/e.count}%`)},null,4),x("span",null,g(e.count),1)],8,de)]))),128))])):(r(),c("button",pe,g(b(Ce)("button.setting")),1))],8,ce)])):C("",!0),x("label",be,[x("div",me,[x("span",fe,g(b(Ce)("table.operation")),1)]),x("div",xe,[x("button",{class:"btn btn-error btn-xs",onClick:l=>b(s)(e)},g(b(Ce)("button.delete")),9,ge)])])],2))),128))]),_:1},8,["modelValue"]),d(V,{"total-number":b(u)?.count,"separated-number":b(u)?.separateCount.countList,onSubmitData:b(L)},null,8,["total-number","separated-number","onSubmitData"])]))}});export{he as default};
